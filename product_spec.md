# Refillio - Product Specification

**Backup Name Reference:** Zapasly (Reserved for future localization or rebranding if needed)

## 1. Executive Summary
Refillio is a "Mini-ERP for the Home," designed to automate the procurement of essential household utilities (toilet paper, soap, cleaning supplies, etc.). By tracking consumption rates and monitoring real-time market prices on Polish platforms (Allegro, Ceneo), Refillio ensures users never run out of essentials while automatically securing the lowest possible price per unit.

## 2. Core Value Proposition
*   **Time Savings:** Eliminates the mental load of remembering to buy utilities.
*   **Cost Savings:** Systematically finds the lowest "price per unit" (e.g., price per roll, per ml) across multiple vendors.
*   **Inventory Intelligence:** Forecasts demand based on actual usage, preventing both shortages and overstocking.

## 3. Product Roadmap (MVP Strategy)

### Phase 1: The Smart Inventory (Weeks 1-3)
*   **Goal:** Establish the "User Warehouse" and data collection habits.
*   **Features:**
    *   **Pantry Management:** Add products from a global catalog.
    *   **Par Levels:** Set "Minimum Stock" triggers for each item.
    *   **Consumption Tracking:** "I just opened one" / "I'm out" actions to train the forecasting model.
    *   **Unit Management:** Define stock in logical units (rolls, bottles, packs).

### Phase 2: The Price Eye (Weeks 4-6)
*   **Goal:** Build the Procurement Engine and Normalization Logic.
*   **Features:**
    *   **Scraper/API Workers:** Fetch prices from Allegro (via API) and Ceneo (via Scraper).
    *   **Unit Normalization:** Convert listing prices to "Price Per Unit" (e.g., Listing: 24 Rolls for 40 PLN -> 1.66 PLN/Roll).
    *   **Shipping Logic:** Account for "Allegro Smart" status and delivery costs in the final price comparison.

### Phase 3: The Deal Hunter (Weeks 7-8)
*   **Goal:** The "Procurement Trigger" and Monetization.
*   **Features:**
    *   **Smart Alerts:** "You have 4 days of Shampoo left. Buy this 3-pack on Allegro to save 15%."
    *   **Savings Calculator:** Compare "Actual Paid" vs. "Market High" to display value.
    *   **Assisted Checkout:** Direct links to pre-filled carts or specific listings.

## 4. Technical Architecture

**Platform:** Web-First (Next.js PWA) + Cross-Platform Mobile Capable.
**Backend:** Node.js (TypeScript) - Modular Monolith.
**Database:** PostgreSQL (Strict 3NF).

### Data Model (3NF)

#### Module A: Identity & Settings
*   **Users:** `id`, `email`, `auth_provider_id`
*   **Profiles:** `user_id`, `currency_pref` (PLN), `language` (EN/PL)
*   **Addresses:** `user_id`, `postal_code` (for shipping calc), `is_allegro_smart` (Bool)
*   **Subscriptions:** `user_id`, `plan_type` (Fixed/Percent), `status`

#### Module B: Global Catalog (The "Truth")
*   **Categories:** Hierarchy (e.g., Home -> Hygiene -> Paper Products)
*   **CanonicalProducts:** The generic definition (e.g., "Toilet Paper 3-ply", "Dish Soap 500ml").
*   **MeasurementUnits:** `symbol` (roll, ml, tab), `type` (volume, count).

#### Module C: Market Intelligence
*   **Providers:** `name` (Allegro, Ceneo), `strategy_key` (api_allegro, html_ceneo).
*   **ProviderListings:** Links a `CanonicalProduct` to a specific URL.
    *   *Crucial Field:* `normalization_factor` (e.g., if listing is 12 rolls, factor = 12).
*   **PriceSnapshots:** Historical price data for trend analysis.

#### Module D: User Warehouse (Inventory)
*   **InventoryItems:** Link `User` to `CanonicalProduct`.
    *   `current_qty`: Current physical count.
    *   `reorder_point`: The "Par Level".
*   **ConsumptionLogs:** Timestamped events ("Opened pack") used for forecasting.
*   **ProcurementOrders:** The "Shopping List" generated by the system.

## 5. Monetization Strategy
1.  **Fixed Subscription:** Annual fee (e.g., 40 PLN).
2.  **Performance Fee:** 10% of "Calculated Savings" per order.
    *   *Calculation:* (Market High Price - Actual Price) * 0.10.

## 6. Long Term Vision
*   **Wholesale Aggregation:** Aggregate demand from 1000 users to negotiate bulk deals directly with manufacturers.
*   **Fully Autonomous Buying:** API integrations to place orders without user intervention.
